# This patch inject a sidecar container which is a HTTP proxy for the 
# controller manager, it performs RBAC authorization against the Kubernetes API using SubjectAccessReviews.
- op: add
  path: /spec/template/spec/containers/0/args/-
  value: "--metrics-bind-address=127.0.0.1:8080"
- op: add
  path: /spec/template/spec/containers/-
  value:
    name: kube-rbac-proxy
    image: gcr.io/kubebuilder/kube-rbac-proxy:v0.5.0
    args:
      - "--secure-listen-address=0.0.0.0:8443"
      - "--upstream=http://127.0.0.1:8080/"
      - "--logtostderr=true"
      - "--v=10"
    ports:
      - containerPort: 8443
        name: https